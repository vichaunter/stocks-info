name: CI
on: [push, pull_request, workflow_dispatch]
jobs:
  # test:
  #   ...
  deploy:
    name: "Deploy to staging"
    runs-on: self-hosted
    # if: github.event_name == 'push' && github.ref == 'refs/heads/master'
    # needs: test
    steps:
    - name: multiple command
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        key: ${{ secrets.KEY }}
        script: |
          pm2 stop stocks-info
          rm -rf /tmp/stocks-info 
          cd /tmp 
          git clone https://github.com/vichaunter/stocks-info.git
          rsync -r /tmp/stocks-info/dist/ /opt/services/stocks-info/dist
          cd /opt/services/stocks-info/
          yarn
          pm2 start stodks-info
